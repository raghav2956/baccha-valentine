<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Timeline Quest</title>
    <style>
      :root {
        --bg-a: #ffe5ec;
        --bg-b: #ffc2d1;
        --card: #fff8fb;
        --text: #3f2434;
        --accent: #d6336c;
        --accent-2: #ff758f;
        --ok: #2b9348;
        --shadow: 0 10px 30px rgba(76, 24, 48, 0.18);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: "Trebuchet MS", "Segoe UI", sans-serif;
        color: var(--text);
        background: radial-gradient(circle at top left, var(--bg-a), var(--bg-b));
        overflow-x: hidden;
      }

      .floating {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 0;
      }

      .floating span {
        position: absolute;
        color: rgba(214, 51, 108, 0.22);
        font-size: 20px;
        animation: floatUp linear infinite;
      }

      .confetti-piece {
        position: fixed;
        top: -12px;
        width: 10px;
        height: 16px;
        opacity: 0.95;
        z-index: 9999;
        pointer-events: none;
        animation: confettiFall linear forwards;
      }

      @keyframes floatUp {
        from {
          transform: translateY(0) scale(1);
          opacity: 0;
        }
        10% {
          opacity: 1;
        }
        80% {
          opacity: 1;
        }
        to {
          transform: translateY(-120vh) scale(1.4);
          opacity: 0;
        }
      }

      @keyframes confettiFall {
        to {
          transform: translate3d(var(--x-drift, 0px), 105vh, 0) rotate(700deg);
          opacity: 0.1;
        }
      }

      .app {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 24px;
      }

      .screen {
        width: min(920px, 100%);
        background: rgba(255, 248, 251, 0.88);
        border: 2px solid rgba(214, 51, 108, 0.22);
        border-radius: 24px;
        box-shadow: var(--shadow);
        padding: 28px;
        display: none;
        backdrop-filter: blur(4px);
      }

      .screen.active {
        display: block;
        animation: popIn 0.35s ease;
      }

      @keyframes popIn {
        from {
          transform: translateY(10px) scale(0.98);
          opacity: 0;
        }
        to {
          transform: translateY(0) scale(1);
          opacity: 1;
        }
      }

      .center {
        text-align: center;
      }

      h1,
      h2 {
        margin: 6px 0 12px;
      }

      .subtitle {
        opacity: 0.82;
        margin-bottom: 20px;
      }

      .btn {
        border: 0;
        border-radius: 999px;
        padding: 12px 22px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: transform 0.2s ease, filter 0.2s ease;
      }

      .btn:hover {
        transform: translateY(-1px);
        filter: brightness(1.02);
      }

      .btn-primary {
        background: linear-gradient(120deg, var(--accent), var(--accent-2));
        color: white;
      }

      .btn-soft {
        background: #ffffff;
        color: var(--accent);
        border: 1px solid rgba(214, 51, 108, 0.28);
      }

      .level-card {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        align-items: start;
      }

      .photo-wrap {
        border-radius: 18px;
        overflow: hidden;
        border: 2px solid rgba(214, 51, 108, 0.25);
        background: #fff;
      }

      .photo-wrap img {
        display: block;
        width: 100%;
        height: 340px;
        object-fit: cover;
      }

      .photo-stack {
        display: grid;
        gap: 10px;
      }

      .caption {
        font-size: 1.05rem;
        line-height: 1.45;
        margin: 10px 0 16px;
      }

      .pill {
        display: inline-block;
        background: rgba(214, 51, 108, 0.12);
        color: #a61e4d;
        padding: 6px 12px;
        border-radius: 999px;
        font-size: 0.85rem;
        font-weight: 700;
      }

      .interaction {
        margin-top: 14px;
        background: #fff;
        border-radius: 14px;
        border: 1px solid rgba(214, 51, 108, 0.2);
        padding: 14px;
      }

      .interaction p {
        margin-top: 0;
      }

      .choice-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .success {
        color: var(--ok);
        font-weight: 700;
      }

      .heart-lock {
        width: 170px;
        height: 150px;
        margin: 8px auto 16px;
        position: relative;
        transform: rotate(-45deg);
        background: linear-gradient(130deg, var(--accent), var(--accent-2));
        border-radius: 20px;
        box-shadow: var(--shadow);
      }

      .heart-lock::before,
      .heart-lock::after {
        content: "";
        position: absolute;
        width: 170px;
        height: 150px;
        background: inherit;
        border-radius: 50%;
      }

      .heart-lock::before {
        top: -80px;
        left: 0;
      }

      .heart-lock::after {
        left: 80px;
        top: 0;
      }

      .lock-inner {
        position: absolute;
        inset: 0;
        transform: rotate(45deg);
        display: grid;
        place-items: center;
        color: white;
        font-size: 2rem;
        font-weight: 800;
      }

      .lock-open {
        animation: unlock 0.9s ease forwards;
      }

      @keyframes unlock {
        to {
          transform: rotate(-45deg) scale(1.1);
          opacity: 0;
          filter: blur(6px);
        }
      }

      .qa {
        text-align: left;
        margin-top: 14px;
      }

      .qa label {
        display: block;
        margin: 8px 0 4px;
        font-weight: 700;
      }

      .qa input {
        width: 100%;
        padding: 11px;
        border: 1px solid rgba(76, 24, 48, 0.3);
        border-radius: 10px;
        font-size: 1rem;
      }

      .proposal-buttons {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 18px;
        flex-wrap: wrap;
      }

      .tiny {
        font-size: 0.88rem;
        opacity: 0.82;
      }

      .final-photo-wrap {
        max-width: 560px;
        margin: 0 auto 14px;
        border-radius: 16px;
        overflow: hidden;
        border: 2px solid rgba(214, 51, 108, 0.25);
        background: #fff;
      }

      .final-photo-wrap img {
        width: 100%;
        height: 360px;
        object-fit: cover;
        display: block;
      }

      @media (max-width: 860px) {
        .level-card {
          grid-template-columns: 1fr;
        }

        .photo-wrap img {
          height: 270px;
        }
      }
    </style>
  </head>
  <body>
    <div class="floating" id="floating"></div>

    <main class="app">
      <section class="screen active center" id="screen-landing">
        <h1>Timeline Quest</h1>
        <p class="subtitle">A mini-adventure through our best memories.</p>
        <button class="btn btn-primary" id="startBtn">Start our story</button>
        <p class="tiny">Hint: each level has a mini challenge.</p>
      </section>

      <section class="screen" id="screen-level"></section>

      <section class="screen center" id="screen-final">
        <h2>Final Page</h2>
        <p class="subtitle">Enter 5 valid nicknames to unlock the final question.</p>
        <div class="final-photo-wrap">
          <img
            id="finalPhoto"
            src="photos/Valentine.jpg"
            data-base="Valentine"
            data-ext-idx="0"
            alt="Final memory"
            onerror="tryNextExt(this)"
          />
        </div>
        <form id="nicknameForm" class="interaction" style="max-width: 680px; margin: 0 auto">
          <p style="margin-top: 0">Enter a nickname:</p>
          <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: center">
            <input id="nicknameInput" autocomplete="off" placeholder="Type nickname" style="min-width: 250px; padding: 10px; border-radius: 10px; border: 1px solid rgba(76, 24, 48, 0.3)" />
            <button class="btn btn-soft" type="submit">Add</button>
          </div>
          <p class="tiny" id="nicknameFeedback" style="margin-top: 8px"></p>
          <p class="tiny" id="nickProgress">Added: 0 / 5</p>
          <p id="nicknameList" class="caption" style="min-height: 28px"></p>
        </form>

        <div id="finalQuestionWrap" style="display: none; margin-top: 14px">
          <h2 style="margin-bottom: 8px">Will you be my valentine?</h2>
          <div class="proposal-buttons">
            <button class="btn btn-primary" id="yesBtnA" type="button">Yes ðŸ’˜</button>
            <button class="btn btn-primary" id="yesBtnB" type="button">Yes, of course ðŸ’–</button>
          </div>
          <p id="finalYesMessage" class="success" style="min-height: 24px; margin-top: 10px"></p>
        </div>
      </section>
    </main>

    <script>
      const config = {
        title: "Timeline Quest",
        levels: [
          {
            title: "Level 1: First Trip Together",
            tag: "Memory Checkpoint",
            caption: "First Trip Together",
            images: ["NYC1", "NYC2"],
            question: "Who's apartment are we in? Say in relation to Raghav",
            answer: "Best Friend",
          },
          {
            title: "Level 2: Favourite Pancake",
            tag: "Memory Checkpoint",
            caption: "Favourite Brunch Spot",
            images: ["FavPancake"],
            question: "Name of dish, restaurant, location",
            answer: "Mickey Mouse Pancake, Light House Cafe, Sausalito",
          },
          {
            title: "Level 3: Laughter and Giggles",
            tag: "Memory Checkpoint",
            caption: "Laughter and Giggles",
            images: ["FavPose"],
            question: "What am I doing here (hint: acronym=JJ)",
            answer: "Jumpin Jhapaka",
          },
          {
            title: "Level 4: Pyaali Expressions",
            tag: "Memory Checkpoint",
            caption: "Pyaali Expressions",
            images: ["DrinkPose1", "DrinkPose2"],
            question: "Name the two spots",
            answer: "Ferry Building, Monterey",
          },
        ],
      };

      const screens = {
        landing: document.getElementById("screen-landing"),
        level: document.getElementById("screen-level"),
        final: document.getElementById("screen-final"),
      };

      const imageExtensions = ["jpg", "jpeg", "png", "webp", "heic"];
      const validNicknames = [
        "cholpal",
        "bulbul",
        "baccha",
        "nunspal",
        "tultul",
        "bulbaliya",
        "sussu",
        "potty",
        "dulbul",
        "gpop",
      ];
      const addedNicknames = new Set();
      const levelState = { index: 0 };

      function showScreen(name) {
        Object.values(screens).forEach((s) => s.classList.remove("active"));
        screens[name].classList.add("active");
      }

      function normalize(str) {
        return str
          .trim()
          .toLowerCase()
          .replace(/[^a-z0-9\s]/g, " ")
          .replace(/\s+/g, " ");
      }

      function tryNextExt(img) {
        const base = img.dataset.base;
        const idx = Number(img.dataset.extIdx || "0") + 1;
        if (idx >= imageExtensions.length) {
          img.onerror = null;
          return;
        }
        img.dataset.extIdx = String(idx);
        img.src = `photos/${base}.${imageExtensions[idx]}`;
      }

      function renderLevel() {
        const level = config.levels[levelState.index];
        if (!level) {
          renderFinalPage();
          showScreen("final");
          return;
        }

        const interactionHTML = `
          <form class="interaction" id="levelQuestionForm">
            <p>${level.question}</p>
            <input id="levelAnswerInput" autocomplete="off" placeholder="Type your answer" />
            <div style="margin-top:10px">
              <button type="submit" class="btn btn-soft">Submit Answer</button>
            </div>
            <p class="tiny" id="interactionFeedback"></p>
          </form>
        `;

        const photoHTML = level.images
          .map(
            (imgBase) => `
            <div class="photo-wrap">
              <img src="photos/${imgBase}.jpg" data-base="${imgBase}" data-ext-idx="0" alt="${level.title}" onerror="tryNextExt(this)" />
            </div>
          `
          )
          .join("");

        screens.level.innerHTML = `
          <div class="level-card">
            <div class="photo-stack">
              ${photoHTML}
            </div>
            <div>
              <span class="pill">${level.tag}</span>
              <h2>${level.title}</h2>
              <p class="caption">${level.caption}</p>
              ${interactionHTML}
            </div>
          </div>
        `;

        showScreen("level");
        wireLevelInteraction(level);
      }

      function wireLevelInteraction(level) {
        const form = document.getElementById("levelQuestionForm");
        const input = document.getElementById("levelAnswerInput");
        const feedback = document.getElementById("interactionFeedback");

        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const isCorrect = normalize(input.value) === normalize(level.answer);
          if (!isCorrect) {
            feedback.textContent = "Not quite. Try again.";
            feedback.className = "tiny";
            return;
          }
          feedback.textContent = "Correct. Level cleared.";
          feedback.className = "success";
          levelState.index += 1;
          setTimeout(renderLevel, 500);
        });
      }

      function renderFinalPage() {
        addedNicknames.clear();
        document.getElementById("nicknameInput").value = "";
        document.getElementById("nicknameFeedback").textContent = "";
        document.getElementById("nickProgress").textContent = "Added: 0 / 5";
        document.getElementById("nicknameList").textContent = "";
        document.getElementById("finalQuestionWrap").style.display = "none";
        document.getElementById("finalYesMessage").textContent = "";
      }

      function setupFinalNicknameFlow() {
        const form = document.getElementById("nicknameForm");
        const input = document.getElementById("nicknameInput");
        const feedback = document.getElementById("nicknameFeedback");
        const progress = document.getElementById("nickProgress");
        const list = document.getElementById("nicknameList");
        const questionWrap = document.getElementById("finalQuestionWrap");

        function updateUI() {
          const values = Array.from(addedNicknames);
          progress.textContent = `Added: ${values.length} / 5`;
          list.textContent = values.length ? `Chosen: ${values.join(", ")}` : "";
          if (values.length >= 5) {
            feedback.textContent = "Unlocked.";
            feedback.className = "success";
            questionWrap.style.display = "block";
          }
        }

        form.addEventListener("submit", (e) => {
          e.preventDefault();
          const raw = input.value.trim();
          const key = normalize(raw);
          if (!key) return;
          if (!validNicknames.includes(key)) {
            feedback.textContent = "Not in the valid nickname list. Try another.";
            feedback.className = "tiny";
            return;
          }
          if (addedNicknames.has(key)) {
            feedback.textContent = "Already added. Enter a different one.";
            feedback.className = "tiny";
            return;
          }
          if (addedNicknames.size >= 5) {
            feedback.textContent = "You already unlocked the final question.";
            feedback.className = "tiny";
            return;
          }
          addedNicknames.add(key);
          input.value = "";
          updateUI();
        });

        document.getElementById("yesBtnA").addEventListener("click", () => {
          document.getElementById("finalYesMessage").textContent = "Best answer. I love you.";
          launchConfetti();
        });
        document.getElementById("yesBtnB").addEventListener("click", () => {
          document.getElementById("finalYesMessage").textContent = "Perfect answer. I love you.";
          launchConfetti();
        });
      }

      function launchConfetti() {
        const colors = ["#d6336c", "#ff758f", "#ffd166", "#06d6a0", "#118ab2", "#ffffff"];
        for (let i = 0; i < 120; i++) {
          const piece = document.createElement("span");
          piece.className = "confetti-piece";
          piece.style.left = `${Math.random() * 100}vw`;
          piece.style.background = colors[Math.floor(Math.random() * colors.length)];
          piece.style.animationDuration = `${1.8 + Math.random() * 1.8}s`;
          piece.style.animationDelay = `${Math.random() * 0.3}s`;
          piece.style.transform = `rotate(${Math.random() * 360}deg)`;
          piece.style.setProperty("--x-drift", `${-120 + Math.random() * 240}px`);
          document.body.appendChild(piece);
          setTimeout(() => piece.remove(), 3800);
        }
      }

      function initFloatingHearts() {
        const floating = document.getElementById("floating");
        for (let i = 0; i < 18; i++) {
          const h = document.createElement("span");
          h.textContent = i % 3 === 0 ? "â™¥" : "â™¡";
          h.style.left = Math.random() * 100 + "%";
          h.style.bottom = -Math.random() * 100 + "px";
          h.style.animationDuration = 8 + Math.random() * 10 + "s";
          h.style.animationDelay = Math.random() * 8 + "s";
          h.style.fontSize = 14 + Math.random() * 22 + "px";
          floating.appendChild(h);
        }
      }

      document.getElementById("startBtn").addEventListener("click", () => {
        levelState.index = 0;
        renderLevel();
      });

      setupFinalNicknameFlow();
      initFloatingHearts();
    </script>
  </body>
</html>
